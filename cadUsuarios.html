<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Master Detail - Teste Front End</title>
</head>

<body>

  <div class="wrapper">

    <form class="cad-form">
      <div class="input-wrapper">
        <span style="display: none" id="nome-error" class="message-error" aria-live="polite">Campo deve conter 3
          caracteres ou mais</span>
        <input type="text" id="nome" name="nome" pattern="[A-Za-z]{3,}">
        <label for="nome">Nome completo(sem abreviações)</label>
      </div>

      <div class="input-wrapper">
        <span style="display: none" id="email-error" class="message-error" aria-live="polite">Esse não é um email
          válido</span>
        <input type="email" id="email" name="email">
        <label for="email">Email</label>
      </div>

      <div class="input-wrapper">
        <span style="display: none" id="cpf-error" class="message-error" aria-live="polite">Esse CPF não é válido</span>
        <input type="text" id="cpf" name="cpf" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" maxlength="14">
        <label for="cpf">CPF</label>
      </div>

      <div class="input-wrapper">
        <span style="display: none" id="telefone-error" class="message-error" aria-live="polite">Esse Telefone não é
          válido</span>
        <input type="text" id="telefone" name="telefone" pattern="\([0-9]{2}\)[\s][0-9]{4,5}-[0-9]{4}">
        <label for="telefone">Telefone:</label>
      </div>

      <div class="btn-actions">
        <button class="btn btn-submit" onclick="getAllUsers()" type="button">Cadastrar</button>
      </div>
    </form>

  </div>

</body>


<script type="text/javascript">
  const nome = document.getElementById("nome");
  const cpf = document.getElementById("cpf");
  const email = document.getElementById("email");
  const telefone = document.getElementById("telefone");

  nome.addEventListener("input", function (event) {
    const error = document.getElementById('nome-error');
    nome.validity.valid ? error.style.display = 'none' : error.style.display = 'block';
  }, false);

  cpf.addEventListener("input", function (event) {
    const error = document.getElementById('cpf-error');
   
    if(cpf.value.length === 14) {

      const str = cpf.value.replaceAll('.', '').replaceAll('-', '');
      const validade = valida_cpf(str);
      console.log('validade', validade)
    }
    cpf.validity.valid ? error.style.display = 'none' : error.style.display = 'block';
  }, false);

  telefone.addEventListener("input", function (event) {
    const error = document.getElementById('telefone-error');
    telefone.validity.valid ? error.style.display = 'none' : error.style.display = 'block';
  }, false);

  email.addEventListener("input", function (event) {
    const error = document.getElementById('email-error');
    email.validity.valid ? error.style.display = 'none' : error.style.display = 'block';
  }, false);
</script>

<script type="text/javascript">
  function valida_cpf(cpf) {
    var numeros, digitos, soma, i, resultado, digitos_iguais;
    digitos_iguais = 1;
    if (cpf.length < 11)
      return false;
    for (i = 0; i < cpf.length - 1; i++)
      if (cpf.charAt(i) != cpf.charAt(i + 1)) {
        digitos_iguais = 0;
        break;
      }
    if (!digitos_iguais) {
      numeros = cpf.substring(0, 9);
      digitos = cpf.substring(9);
      soma = 0;
      for (i = 10; i > 1; i--)
        soma += numeros.charAt(10 - i) * i;
      resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
      if (resultado != digitos.charAt(0))
        return false;
      numeros = cpf.substring(0, 10);
      soma = 0;
      for (i = 11; i > 1; i--)
        soma += numeros.charAt(11 - i) * i;
      resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
      if (resultado != digitos.charAt(1))
        return false;
      return true;
    } else
      return false;
  }
</script>

<script src="./js/index.js"></script>

</html>